/*
 * @creater: zhengpeng.ren
 * @since: 2024/11/25
 * @LastAuthor: zhengpeng.ren
 * @Descripttion: popup style
 */
@import '../../styles/mixins/bem.mixin.scss';
@import './variables.scss';

:host {
  display: contents;
}

// 激活状态: 减速进入 (Ease Out Back)
:host([active]) .nv-popup__content {
  transform: scale(1);
  opacity: 1;
  transition: 
    opacity 0.2s cubic-bezier(0.34, 1.3, 0.64, 1),
    transform 0.2s cubic-bezier(0.34, 1.3, 0.64, 1);
}

// 使用@starting-style来定义过渡的开始状态
// 这样浏览器才能正确识别display从none变为flex时动画的开始状态
// 注意：以下样式必须写在上面激活状态样式的下面
@starting-style {
  :host([active]) .nv-popup__content {
    opacity: 0;
    transform: scale(0.5);
  }
}

@include b(popup) {
  display: inline-flex;
  flex: 1;
  align-items: center;
  justify-content: center;

  &__anchor {
    display: inline-flex;
    flex: 1;
  }

  /* --- Positioner (Wrapper) --- */
  &__popup {
    position: absolute;
    z-index: var(--nv-popup-z-index, 2000);
    box-sizing: border-box;
    
    /* Control visibility via display */
    display: none;
    
    /* Allow display transition for exit animations */
    transition: display 0.15s allow-discrete, overlay 0.15s allow-discrete;
  }

  &--active &__popup {
    display: flex; 
  }

  &__content {
    position: relative;
    background-color: var(--nv-popup-background-color, #fff);
    border: 1px solid var(--nv-popup-border-color, #e4e7ed);
    border-radius: var(--nv-popup-border-radius, 4px);
    box-shadow: var(--nv-popup-box-shadow, 0 2px 12px 0 rgba(0, 0, 0, 0.1));
    padding: var(--nv-popup-padding, 12px);
    min-width: var(--nv-popup-min-width); 
    box-sizing: border-box;

    /* 动态变换原点 */
    transform-origin: var(--origin, center bottom);
    
    /* 退出时的过渡效果: 加速离开 (Ease In) */
    opacity: 0.5;
    transform: scale(0.5);
    transition: 
      opacity 0.1s cubic-bezier(0.4, 0, 0.7, 0.2), 
      transform 0.1s cubic-bezier(0.4, 0, 0.7, 0.2);
  }

  /* --- 箭头 --- */
  &--arrow &__content {
    &::before,
    &::after {
      content: '';
      position: absolute;
      width: 0;
      height: 0;
      border: 6px solid transparent;
      pointer-events: none;
    }
  }
  
  /* Top Arrow */
  &--arrow.nv-popup--top &__content,
  &--arrow.nv-popup--top-start &__content,
  &--arrow.nv-popup--top-end &__content {
    &::before {
      bottom: -12px;
      border-top-color: var(--nv-popup-border-color, #e4e7ed);
    }
    &::after {
      bottom: -11px;
      border-top-color: var(--nv-popup-background-color, #fff);
    }
  }

  &--arrow.nv-popup--top &__content {
    &::before, &::after { left: 50%; transform: translateX(-50%); }
  }
  &--arrow.nv-popup--top-start &__content {
    &::before, &::after { left: 16px; }
  }
  &--arrow.nv-popup--top-end &__content {
    &::before, &::after { right: 16px; }
  }

  /* Bottom Arrow */
  &--arrow.nv-popup--bottom &__content,
  &--arrow.nv-popup--bottom-start &__content,
  &--arrow.nv-popup--bottom-end &__content {
    &::before {
      top: -12px;
      border-bottom-color: var(--nv-popup-border-color, #e4e7ed);
    }
    &::after {
      top: -11px;
      border-bottom-color: var(--nv-popup-background-color, #fff);
    }
  }

  &--arrow.nv-popup--bottom &__content {
    &::before, &::after { left: 50%; transform: translateX(-50%); }
  }
  &--arrow.nv-popup--bottom-start &__content {
    &::before, &::after { left: 16px; }
  }
  &--arrow.nv-popup--bottom-end &__content {
    &::before, &::after { right: 16px; }
  }

  /* Left Arrow */
  &--arrow.nv-popup--left &__content,
  &--arrow.nv-popup--left-start &__content,
  &--arrow.nv-popup--left-end &__content {
    &::before {
      right: -12px;
      border-left-color: var(--nv-popup-border-color, #e4e7ed);
    }
    &::after {
      right: -11px;
      border-left-color: var(--nv-popup-background-color, #fff);
    }
  }

  &--arrow.nv-popup--left &__content {
    &::before, &::after { top: 50%; transform: translateY(-50%); }
  }
  &--arrow.nv-popup--left-start &__content {
    &::before, &::after { top: 16px; }
  }
  &--arrow.nv-popup--left-end &__content {
    &::before, &::after { bottom: 16px; }
  }

  /* Right Arrow */
  &--arrow.nv-popup--right &__content,
  &--arrow.nv-popup--right-start &__content,
  &--arrow.nv-popup--right-end &__content {
    &::before {
      left: -12px;
      border-right-color: var(--nv-popup-border-color, #e4e7ed);
    }
    &::after {
      left: -11px;
      border-right-color: var(--nv-popup-background-color, #fff);
    }
  }

  &--arrow.nv-popup--right &__content {
    &::before, &::after { top: 50%; transform: translateY(-50%); }
  }
  &--arrow.nv-popup--right-start &__content {
    &::before, &::after { top: 16px; }
  }
  &--arrow.nv-popup--right-end &__content {
    &::before, &::after { bottom: 16px; }
  }
}
